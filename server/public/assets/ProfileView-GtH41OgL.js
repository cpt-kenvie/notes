import{u as U,r as f,h as C,c as l,g as y,a,i as v,t as d,b as c,v as p,o}from"./index-Bzc35kCV.js";import{_ as T,r as m}from"./_plugin-vue_export-helper-ByqkmB3O.js";import{T as I,a as N}from"./TheFooter-B4kNUWYv.js";const S={class:"layout"},B={class:"profile-container"},P={class:"profile-header"},D={class:"profile-content"},E={class:"avatar-section"},M=["src","alt"],$={key:0,class:"avatar-upload"},A={class:"info-section"},F={class:"form-group"},J={class:"info-text"},O={class:"form-group"},R={key:1,class:"info-text"},q={class:"form-group"},z={key:1},H={key:2},L={class:"form-group"},W={key:1,class:"info-text"},j=["href"],G={class:"form-group"},K={key:1,class:"info-text"},Q={key:0,class:"action-buttons"},X={__name:"ProfileView",setup(Y){const u=U(),n=f(!1),s=f({}),t=f({}),b=async()=>{try{const i=localStorage.getItem("username"),e=await m(`/api/users/profile/${i}`);s.value=e.user}catch{u.error("获取用户信息失败")}},g=()=>{t.value={...s.value},n.value=!0},h=()=>{n.value=!1,t.value={...s.value}},k=async()=>{try{const i=s.value.username;await m(`/api/users/profile/${i}`,{method:"PUT",body:JSON.stringify({email:t.value.email,website:t.value.website,desc:t.value.desc,age:t.value.age})}),s.value={...t.value},n.value=!1,u.success("个人信息已更新")}catch{u.error("更新失败")}},w=async i=>{const e=i.target.files[0];if(e){if(!e.type.startsWith("image/")){u.error("请选择图片文件");return}if(e.size>2*1024*1024){u.error("图片大小不能超过2MB");return}try{const r=new FileReader;r.onload=async x=>{const _=x.target.result,V=s.value.username;await m(`/api/users/profile/${V}/avatar`,{method:"PUT",body:JSON.stringify({avatar_url:_})}),s.value.avatar_url=_,u.success("头像已更新")},r.readAsDataURL(e)}catch{u.error("头像更新失败")}}};return C(()=>{b()}),(i,e)=>(o(),l("div",S,[y(I),a("div",B,[a("div",P,[e[4]||(e[4]=a("h1",null,"个人信息",-1)),n.value?v("",!0):(o(),l("button",{key:0,class:"edit-btn",onClick:g}," 编辑资料 "))]),a("div",D,[a("div",E,[a("img",{src:s.value.avatar_url,alt:s.value.username,class:"profile-avatar"},null,8,M),n.value?(o(),l("div",$,[a("input",{type:"file",accept:"image/*",class:"file-input",onChange:w,id:"avatar-upload"},null,32),e[5]||(e[5]=a("label",{for:"avatar-upload",class:"upload-btn"},"更换头像",-1))])):v("",!0)]),a("div",A,[a("div",F,[e[6]||(e[6]=a("label",null,"用户名",-1)),a("div",J,d(s.value.username),1)]),a("div",O,[e[7]||(e[7]=a("label",null,"邮箱",-1)),n.value?c((o(),l("input",{key:0,"onUpdate:modelValue":e[0]||(e[0]=r=>t.value.email=r),type:"email",placeholder:"请输入邮箱"},null,512)),[[p,t.value.email]]):(o(),l("div",R,d(s.value.email),1))]),a("div",q,[e[8]||(e[8]=a("label",null,"年龄",-1)),n.value?c((o(),l("input",{key:0,"onUpdate:modelValue":e[1]||(e[1]=r=>t.value.age=r),type:"number",min:"1",max:"120",placeholder:"请输入年龄"},null,512)),[[p,t.value.age,void 0,{number:!0}]]):v("",!0),s.value.age||s.value.age===0?(o(),l("div",z,d(s.value.age)+" 岁",1)):(o(),l("div",H,"保密"))]),a("div",L,[e[9]||(e[9]=a("label",null,"个人网站",-1)),n.value?c((o(),l("input",{key:0,"onUpdate:modelValue":e[2]||(e[2]=r=>t.value.website=r),type:"url",placeholder:"请输入网址"},null,512)),[[p,t.value.website]]):(o(),l("div",W,[a("a",{href:s.value.website,target:"_blank",class:"website-link"},d(s.value.website),9,j)]))]),a("div",G,[e[10]||(e[10]=a("label",null,"个人简介",-1)),n.value?c((o(),l("textarea",{key:0,"onUpdate:modelValue":e[3]||(e[3]=r=>t.value.desc=r),rows:"3",placeholder:"介绍一下自己吧"},null,512)),[[p,t.value.desc]]):(o(),l("div",K,d(s.value.desc),1))]),n.value?(o(),l("div",Q,[a("button",{class:"cancel-btn",onClick:h},"取消"),a("button",{class:"save-btn",onClick:k},"保存")])):v("",!0)])])]),y(N)]))}},se=T(X,[["__scopeId","data-v-a448d1c9"]]);export{se as default};
